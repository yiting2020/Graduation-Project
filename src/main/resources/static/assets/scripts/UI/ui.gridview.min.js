(function(){if(!ui||!ui.ColumnStyle){throw new Error("please include ui.columnStyle.js")}var e="gridview-check",t="gridview-check-all",i="last-cell",r="fa-sort",s="fa-sort-asc",n="fa-sort-desc";var a="pageTurning",l="selecting",o="selected",h="deselected",d="rebind";var u=/^((?:[\w\u00c0-\uFFFF\*_-]|\\.)+)/,c=/\[\s*((?:[\w\u00c0-\uFFFF_-]|\\.)+)\s*(?:(\S?=)\s*(['"]*)(.*?)\3|)\s*\]/;var f=function(e){if(e.displayDataInfo!==false){e.displayDataInfo=true;e.pageInfoFormatter={currentRowNum:function(e){return"<span>本页"+e+"行</span>"},rowCount:function(e){return"<span class='font-highlight'>共"+e+"行</span>"},pageCount:function(e){return"<span>"+e+"页</span>"}}}if(!$.isNumeric(e.pageIndex)&&!$.isNumeric(e.pageSize)){return}this.pager=new ui.ctrls.Pager(e);this.pageIndex=this.pager.pageIndex;this.pageSize=this.pager.pageSize};var p=function(e,t){var i=0,r=e.length-1,s=e.length/2;var n;for(;i<s;i++,r--){n=e[i];e[i]=e[r];e[r]=n;n=t[i];t[i]=t[r];t[r]=n}};var g=function(e,t){var i,r,s;if($.isArray(e)){i=0;for(r=0,s=e.length;r<s;r++){i=v(e[r],t[r]);if(i!==0){return i}}return i}else{return v(e,t)}};var v=function(e,t){if(typeof e==="string"){return e.localeCompare(t)}if(e<t){return-1}else if(e>t){return 1}else{return 0}};var m=ui.define("ctrls.GridView",{_getOption:function(){return{columns:[],dataTable:null,promptText:"没有数据",gridId:null,height:false,width:false,pager:{pageIndex:1,pageSize:100,pageButtonCount:10,displayDataInfo:true},selection:{type:"row",exclude:false,multiple:false}}},_getEvents:function(){return[a,l,o,h,d]},_create:function(){this.gridColumns=null;this.dataTable=null;this.selectList=[];this.sorterIndexes=[];this.columnStateFunctions={};this.hasPrompt=!!this.option.promptText;this.gridHead=null;this.gridBody=null;this.columnHeight=30;this.pagerHeight=30;this.pager=null;if(this.option.pager){f.call(this,this.option.pager)}else{this.pageIndex=1;this.pageSize=100}if(!$.isNumeric(this.option.width)||this.option.width<=0)this.option.width=false;if(!$.isNumeric(this.option.height)||this.option.height<=0)this.option.height=false;this.sorter=new ui.Introsort;this._checkedCount=0},_init:function(){if(!this.element){this.element=$("#"+this.option.gridId);if(this.element.length==0){throw new Error("grid div not exists!")}}this._initBorderWidth();this.gridHead=$("<div class='grid-head' />");this.gridBody=$("<div class='grid-body' />");if(this.hasPrompt){this.dataPrompt=$("<div class='data-prompt'>");this.gridBody.append(this.dataPrompt);this._initDataPrompt()}this.element.append(this.gridHead);this.element.append(this.gridBody);if(this.pager){this.gridFoot=$("<div class='view-foot' />");this.pager.pageNumPanel=$("<div class='page-panel' />");if(this.option.pager.displayDataInfo){this.pager.pageInfoPanel=$("<div class='data-info' />");this.gridFoot.append(this.pager.pageInfoPanel)}else{this.pager.pageNumPanel.css("width","100%")}this.gridFoot.append(this.pager.pageNumPanel).append($("<br style='clear:both' />"));this.element.append(this.gridFoot);this.pager.pageChanged(function(e,t){this.pageIndex=e;this.pageSize=t;this.fire(a,e,t)},this)}this.setSize(this.option.width,this.option.height);this.onSortProxy=$.proxy(this.onSort,this);var e=0;this.createGridHead(this.option.columns);if($.isArray(this.option.dataTable)){e=this.option.dataTable.length;this.createGridBody(this.option.dataTable,e)}this.gridBody.scroll($.proxy(this.onScrollingX,this))},_initBorderWidth:function(){this.borderHeight=0;var e=parseInt(this.element.css("border-top-width"),10);if(isNaN(e)){e=0}this.borderHeight+=e;e=parseInt(this.element.css("border-bottom-width"),10);if(isNaN(e)){e=0}this.borderHeight+=e;this.borderWidth=0;e=parseInt(this.element.css("border-left-width"),10);if(isNaN(e)){e=0}this.borderWidth+=e;e=parseInt(this.element.css("border-right-width"),10);if(isNaN(e)){e=0}this.borderWidth+=e},createGridHead:function(e){this.gridColumns=e;if(!this.tableHead){this.tableHead=$("<table class='table-head' cellspacing='0' cellpadding='0' />");this.gridHead.append(this.tableHead)}else{this.tableHead.html("")}var t=$("<colgroup />"),r=$("<thead />");this.tableHead.append(t);var s=$("<tr />"),n=null,a=null;var l=null;for(var o=0;o<e.length;o++){a=e[o];if(!a._columnKeys){a._columnKeys={}}t.append(this.createCol(a));n=this.createCell("th",a);l=[a,n];if($.isFunction(a.text)){n.append(a.text.apply(this,l))}else{if(a.text){n.append(ui.ColumnStyle.cnfn.columnText.apply(this,l))}}this.setSorter(n,a,o);if(o==e.length-1){n.addClass(i)}s.append(n)}this.headScrollCol=$("<col style='width:0px' />");t.append(this.headScrollCol);s.append($("<th class='scroll-cell' />"));r.append(s);this.tableHead.append(r)},createGridBody:function(e,t){var i=false;if(!this.tableBody){this.tableBody=$("<table class='table-body' cellspacing='0' cellpadding='0' />");if(this.isSelectable())this.tableBody.click($.proxy(this.onElementSelected,this));this.gridBody.append(this.tableBody)}else{this.gridBody.scrollTop(0);this.empty(false);i=true}this.dataTable=e;if(!$.isArray(this.dataTable)){this.dataTable=[]}if(this.dataTable.length==0){this.showDataPrompt();return}else{this.hideDataPrompt()}var r=$("<colgroup />"),s=$("<tbody />");this.tableBody.append(r);var n,a,l,o;var h=this.gridColumns.length;this._tempHandler=null;for(l=0;l<h;l++){o=this.gridColumns[l];r.append(this.createCol(o))}for(a=0;a<e.length;a++){n=$("<tr />");this._createCells(n,e[a],a);s.append(n)}this.tableBody.append(s);this._updateScrollState();if($.isNumeric(t)){this.renderPageList(t)}if(i){this.fire(d)}},_createCells:function(e,t,r){var s=this.gridColumns.length;var n;var a,l,o,h,d;for(a=0;a<s;a++){l=this.gridColumns[a];if($.isFunction(l.handler)){n=l.handler}else{n=ui.ColumnStyle.cfn.defaultText}o=this.prepareValue(t,l);h=this.createCell("td",l);d=n.apply(this,[o,l,r,h]);if(h.isAnnul)continue;if(d)h.append(d);if(a==s-1){h.addClass(i)}e.append(h);if(h.isFinal){h.addClass(i);break}}},prepareValue:function(e,t){var i,r,s;if($.isArray(t.column)){i={};for(r=0,s=t.column.length;r<s;r++){i[r]=this._getValue(e,t.column[r],t);i[t.column[r]]=i[r]}}else{i=this._getValue(e,t.column,t);if(i===undefined||i===null)i=""}return i},_getValue:function(e,t,i){if(typeof t!=="string"){return null}if(!i._columnKeys.hasOwnProperty(t)){i._columnKeys[t]=t.split(".")}var r=i._columnKeys[t];var s=0;var n=e[r[s]];for(s=1;s<r.length;s++){n=n[r[s]];if(n===undefined||n===null){return n}}return n},createCol:function(e){var t=$("<col />");var i={};if(!isNaN(parseInt(e.len)))i["width"]=e.len+"px";t.css(i);return t},createCell:function(e,t){var i=$("<"+e+" />");var r={};if(t.align)r["text-align"]=t.align;i.css(r);return i},setSorter:function(e,t,i){if(t.sort===true||$.isFunction(t.sort)){e.click(this.onSortProxy);e.addClass("sorter");e.append("<i class='fa fa-sort'></i>");this.sorterIndexes.push(i)}},empty:function(){if(this.tableBody){this.tableBody.html("");this.dataTable=null;this.selectList=[];this.current=null;this.cancelColumnState()}if(this.tableHead){this.resetSortColumnState();this.lastSortColumn=null}if(this.pager){this.pager.empty()}if(arguments[0]!==false){this.showDataPrompt()}},renderPageList:function(e){if(!this.pager){return}this.pager.data=this.dataTable;this.pager.pageIndex=this.pageIndex;this.pager.pageSize=this.pageSize;this.pager.renderPageList(e)},isSelectable:function(){var e=this.option.selection.type;return e==="row"||e==="cell"},isMultipleSelectable:function(){return(this.option.selection.type==="row"||this.option.selection.type==="cell")&&this.option.selection.multiple===true},onScrollingX:function(e){var t=this.gridBody.scrollLeft();this.gridHead.scrollLeft(t)},onAllSelected:function(e){e.stopPropagation();var t=$(e.target);var i=t.prop("name");i=i.split("_");i.splice(i.length-1,1);i=i.join("_");var r=this.gridBody.find("input[type='checkbox'][name='"+i+"']");var s=t.prop("checked"),n,a,l,o,h;if(r.length>0){if(this.isMultipleSelectable()){n=this.option.selection.type==="cell"?"TD":"TR";a=this.option.selection.type==="cell"?"cell-selected":"row-selected";if(s){for(h=0;h<this.selectList.length;h++){this.selectList[h].removeHighlight(a,"background")}this.selectList=[]}o=this;l=function(e){var t;while((t=e.nodeName())!==n){if(t==="TABLE")return;e=e.parent()}o.multipleSelection(e,a,s)}}r.prop("checked",function(e,t){var i=$(this);i.prop("checked",s);if(l)l(i)});if(s)this._checkedCount=this.count();else this._checkedCount=0}},prepareRowCheckboxChangeHandler:function(){var t;if(!this._isBindRowCheckboxChangeHandler){t=this;this.tableBody.change(function(i){var r=$(i.target);if(!r.hasClass(e)){return}if(!t._gridviewCheckAll){t._gridviewCheckAll=t.tableHead.find(".gridview-check-all")}if(r.prop("checked")){t._checkedCount++}else{t._checkedCount--}if(t._checkedCount==t.count()){t._gridviewCheckAll.prop("checked",true)}else{t._gridviewCheckAll.prop("checked",false)}});this._isBindRowCheckboxChangeHandler=true}},onElementSelected:function(e){var t=$(e.target),i=this.option.selection.type==="cell"?"TD":"TR",r=this.option.selection.type==="cell"?"cell-selected":"row-selected";var s;var n=this.option.selection.exclude,a=true;if(n){if(typeof n==="string"){a=this._excludeElement(t,n)}else if($.isFunction(n)){a=n.call(this,t)}if(a===false)return}while((s=t.nodeName())!==i){if(s==="TABLE")return;t=t.parent()}if(this.option.selection.multiple===true){this.multipleSelection(t,r)}else{this.singleSelection(t,r)}},onSort:function(e){e.stopPropagation();if(!$.isArray(this.dataTable)||this.dataTable.length==0){return}var t=$(e.target),i;while((i=t.nodeName())!=="TH"){if(i=="TR"){return}t=t.parent()}var a=t[0].cellIndex;var l=this.gridColumns[a];if(this.lastSortColumn!==l){this.resetSortColumnState(t.parent())}var o=$.proxy(this.sorting,this);var h=this.lastSortColumn==l;this.lastSortColumn=l;var d=this.tableBody.find("tbody");var u=d.children().get();if(!$.isArray(u)||u.length!=this.dataTable.length){throw new Error("data row error!")}var c=t.find("i");if(c.hasClass(s)){p(this.dataTable,u);c.removeClass(r).removeClass(s).addClass(n)}else{if(h){p(this.dataTable,u)}else{this.sorter.items=u;this.sorter.sort(this.dataTable,o)}c.removeClass(r).removeClass(n).addClass(s)}d.append(u);this.refreshRowNumber()},sorting:function(e,t){var i=this.lastSortColumn;var r=i.sort;if(!$.isFunction(r)){r=g}var s=this.prepareValue(e,i);var n=this.prepareValue(t,i);return r(s,n)},resetSortColumnState:function(e){if(!e){e=this.tableHead.find("tr")}var t,i=e.children(),s,n;for(s=0,n=this.sorterIndexes.length;s<n;s++){t=$(i[this.sorterIndexes[s]]);t=t.find("i");if(!t.hasClass(r)){t.attr("class","fa fa-sort");return}}},singleSelection:function(e,t){var i=this.prepareData(e);var r=this.fire(l,e,i);if(r===false)return;if(this.current){this.current.removeHighlight(t,"background");var s=this.prepareData(this.current);if(this.current[0]===e[0]){this.fire(h,this.current,s);this.current=null;return}}e.addHighlight(t,"background");this.current=e;this.fire(o,e,i)},multipleSelection:function(e,t,i){var r=null;if(e.hasClass(t)){if(i===true){return}e.removeHighlight(t,"background");for(var s=0;s<this.selectList.length;s++){if(this.selectList[s][0]===e[0]){this.selectList.splice(s,1);break}}r=this.prepareData(e);this.fire(h,e,r)}else{if(i===false){return}r=this.prepareData(e);var n=this.fire(l,e,r);if(n===false)return;e.addHighlight(t,"background");this.selectList.push(e);this.fire(o,e,r)}},prepareData:function(e){var t={};if(this.option.selection.type==="cell"){t.rowIndex=e.parent().prop("rowIndex");t.rowData=this.dataTable[t.rowIndex];t.cellIndex=e.prop("cellIndex");t.columns=this.gridColumns[t.cellIndex].column}else{t.rowIndex=e.prop("rowIndex");t.rowData=this.dataTable[t.rowIndex]}return t},_excludeElement:function(e,t){var i=e.nodeName().toLowerCase(),r=t.split(","),s,n,a=0,l=r.length;for(;a<l;a++){s=$.trim(r[a]);n=s.match(c);if(n){s=s.match(u)[1];if(s===i){return!(e.attr(n[1])===n[4])}}else{if(s.toLowerCase()===i){return false}}}},getSelectedValue:function(){var t=this.gridBody.find("."+e);var i=[];var r=0,s=t.length,n=null;for(;r<s;r++){n=$(t[r]);if(n.prop("name").indexOf("_all")>=0||!n.prop("checked"))continue;i.push(n.val())}return i},hasSelection:function(){if(this.option.selection.multiple===true){return this.selectList.length>0}else{return!!this.current}},getCurrentSelection:function(){var e=null;if(this.current)e=this.prepareData(this.current);return e},getMultipleSelection:function(){var e=[];if(this.selectList){for(var t=0;t<this.selectList.length;t++){e.push(this.prepareData(this.selectList[t]))}}return e},selectRow:function(e){if(!this.dataTable){return}var t="row-selected",i;if(e>=0&&e<this.dataTable.length){i=$(this.tableBody[0].rows[e]);if(this.option.selection.multiple===true){this.multipleSelection(i,t)}else{this.singleSelection(i,t)}}},selectCell:function(e,t){if(!this.dataTable){return}var i="cell-selected",r;if(e>=0&&e<this.dataTable.length){if(t>=0&&t<this.gridColumns.length){r=$(this.tableBody[0].rows[e].cells[t]);if(this.option.selection.multiple===true){this.multipleSelection(r,i)}else{this.singleSelection(r,i)}}}},cancelSelection:function(){if(this.option.selection.type==="disabled")return;var e=this.option.selection.type==="cell"?"cell-selected":"row-selected",t,i;if(this.option.selection.multiple){if(this.selectList.length==0){return}i=[];for(var r=0,s=this.selectList.length,n;r<s;r++){t=this.selectList[r];t.removeHighlight(e,"background");n=this.prepareData(t);n.element=t;i.push(n)}t=null;this.selectList=[]}else{if(!this.current){return}t=this.current;i=this.prepareData(t);t.removeHighlight(e,"background");this.current=null}this.fire(h,t,i)},cancelColumnState:function(){var e=null;for(var t in this.columnStateFunctions){e=this.columnStateFunctions[t];if($.isFunction(e)){try{e.call(this)}catch(i){}}}},count:function(){if(!this.dataTable){return 0}return this.dataTable.length},removeRow:function(e){if(!e)return;if(!ui.core.isJQueryObject(e)){e=$(e)}var t=e[0].rowIndex;if(this.current&&this.current[0]==e[0]){this.current=null}e.remove();this.dataTable.splice(t,1);this._updateScrollState();this.refreshRowNumber(t-1)},removeRowByIndex:function(e){if(!this.dataTable){return}if(e>=0&&e<this.dataTable.length){this.removeRow(this.tableBody[0].rows[e])}},updateRow:function(e,t){if(!e||!t){return}if(!ui.core.isJQueryObject(e)){e=$(e)}var i=e[0].rowIndex;e.html("");this.dataTable[i]=t;this._createCells(e,t,i)},updateRowByIndex:function(e,t){if(!this.dataTable){return}if(e>=0&&e<this.dataTable.length){this.updateRow(this.tableBody[0].rows[e],t)}},appendRow:function(e){if(!e)return;if(!$.isArray(this.dataTable)||this.dataTable.length==0){if(this.tableBody){this.tableBody.remove();this.tableBody=null}this.createGridBody([e]);return}var t=$("<tr />");this.dataTable.push(e);this._createCells(t,e,this.dataTable.length-1);$(this.tableBody[0].tBodies[0]).append(t);this._updateScrollState()},insertRow:function(e,t){var i=null;if(!t)return;if(!$.isArray(this.dataTable)||this.dataTable.length==0){this.appendRow(t);return}if(e<0){e=0}if(e>=0&&e<this.dataTable.length){i=$("<tr />");this.dataTable.splice(e,0,t);this._createCells(i,t,e);$(this.tableBody[0].rows[e]).before(i);this._updateScrollState();this.refreshRowNumber(e)}else{this.appendRow(t)}},refreshRowNumber:function(e,t){if(!this.dataTable||this.dataTable.length==0)return;var i=this._findRowNumberColumnIndex(),r=ui.ColumnStyle.cfn.rowNumber;if(i==-1)return;if(isNaN(e))e=0;else e+=1;var s=this.tableBody[0].rows;var n,a=this.gridColumns[i],l,o=$.isNumeric(t)?t+1:s.length;for(l=e;l<o;l++){n=$(s[l].cells[i]);n.html("");n.append(r.apply(this,[null,a,l]))}},_findRowNumberColumnIndex:function(){var e=-1;var t,i=this.gridColumns.length,r;for(t=0;t<i;t++){r=this.gridColumns[t];if(r.handler===ui.ColumnStyle.cfn.rowNumber){e=t;break}}return e},currentUp:function(){var e=this.getCurrentSelection();if(!e||e.rowIndex==0){return}this.moveRow(e.rowIndex,e.rowIndex-1)},currentDown:function(){var e=this.getCurrentSelection();if(!e||e.rowIndex>=this.count()){return}this.moveRow(e.rowIndex,e.rowIndex+1)},moveRow:function(e,t){var i=this.count();if(i==0){return}if(t<0){t=0}else if(t>=i){t=i-1}if(t==e){return}var r=this.tableBody[0].rows,s=$(r[t]);var n=this.dataTable[e];this.dataTable.splice(e,1);this.dataTable.splice(t,0,n);if(t>e){s.after($(r[e]));this.refreshRowNumber(e-1,t)}else{s.before($(r[e]));this.refreshRowNumber(t-1,e)}},getRowData:function(e){if(!this.dataTable||this.dataTable.length==0){return null}if(!$.isNumeric(e)||e<0||e>=this.dataTable.length){return null}return this.dataTable[e]},getLastRowData:function(){if(!this.dataTable||this.dataTable.length==0){return null}return this.dataTable[this.dataTable.length-1]},getFirstRowData:function(){return this.getRowData(0)},setHeight:function(e){if($.isNumeric(e)){e-=this.columnHeight+this.borderHeight;if(this.pager)e-=this.pagerHeight;this.gridBody.css("height",e+"px");if(arguments.length==1){this._updateScrollState();if(this.promptIsShow()){this._setPromptLocation()}}}},setWidth:function(e){if($.isNumeric(e)){e-=this.borderWidth;this.element.css("width",e+"px");if(arguments.length==1){this._updateScrollState();if(this.promptIsShow()){this._setPromptLocation()}}}},setSize:function(e,t){this.setWidth(e,false);this.setHeight(t,false);this._updateScrollState();if(this.promptIsShow()){this._setPromptLocation()}},_updateScrollState:function(){if(!this.tableHead)return;var e=this.gridBody.height(),t=this.gridBody.width(),i=this.gridBody.get(0).scrollHeight,r=this.gridBody.get(0).scrollWidth;if(i>e){this.headScrollCol.css("width",ui.scrollbarWidth+.1+"px")}else{this.headScrollCol.css("width","0px")}},_initDataPrompt:function(){var e=this.option.promptText;if(ui.core.type(e)==="string"&&e.length>0){this.dataPrompt.html("<span class='font-highlight'>"+e+"</span>")}else if($.isFunction(e)){e=e();this.dataPrompt.append(e)}},_setPromptLocation:function(){var e=this.dataPrompt.height();this.dataPrompt.css("margin-top",-(e/2)+"px")},showDataPrompt:function(){if(!this.hasPrompt){return}this.dataPrompt.css("display","block");this._setPromptLocation()},hideDataPrompt:function(){if(!this.hasPrompt){return}this.dataPrompt.css("display","none")},promptIsShow:function(){return this.hasPrompt&&this.dataPrompt.css("display")==="block"}});$.fn.setGridview=function(e){if(this.length==0){return null}if(e.selection){if(typeof e.selection.type==="string"){e.selection.type=e.selection.type.toLowerCase()}else{e.selection.type="disabled"}}return m(e,this)}})();(function(){var e="_children",t="_parent",i="_fromList";var r=function(e){return this[e]};var s=function(){if(this instanceof s){this.initial()}else{return new s}};s.prototype={constructor:s,initial:function(){this.lazy=false;this.loadChildrenHandler=null;this.gridview=null;var e=this;this.onFoldButtonClickHandler=function(t){t.stopPropagation();e.onFoldButtonClick(t)}},formatLevelNode:function(e,t,i,r){if(!e){return null}var s=this.dataTable[i];if(!$.isNumeric(s._level)){s._level=0}var n=$("<span />").text(e);n.css("margin-left",(s._level+1)*(12+5)+5+"px");return n},formatTreeNode:function(e,t,i,r){if(!e){return null}var s=this.dataTable[i];if(!$.isNumeric(s._level)){s._level=0}var n=$("<span />").text(e),a=null;if(this.treeGrid.isTreeNode(s)){s._isFolded=false;n=[null,n[0]];if(this.treeGrid.lazy){a=$("<i class='fold font-highlight-hover fa fa-angle-right' />")}else{a=$("<i class='fold unfold font-highlight-hover fa fa-angle-down' />")}a.css("margin-left",s._level*(12+5)+5+"px");a.click(this.treeGrid.onFoldButtonClickHandler);n[0]=a[0]}else{n.css("margin-left",(s._level+1)*(12+5)+5+"px")}return n},onFoldButtonClick:function(e){var t=$(e.target),i=t.parent().parent()[0].rowIndex,r=this.gridview.getRowData(i);if(t.hasClass("unfold")){r._isFolded=true;t.removeClass("unfold").removeClass("fa-angle-down").addClass("fa-angle-right");this.hideChildren(r,i)}else{r._isFolded=false;t.addClass("unfold").removeClass("fa-angle-right").addClass("fa-angle-down");this.showChildren(r,i)}},addChildren:function(i,r,s){var n=0,a=s.length,l;var o=r+1,h;i[e]=[];for(;n<a;n++){l=s[n];l._level=i._level+1;l[t]=i;i[e].push(o);h=$("<tr />");this.gridview.dataTable.splice(o,0,l);this.gridview._createCells(h,l,o);if(o<this.gridview.dataTable.length-1){$(this.gridview.tableBody[0].rows[o]).before(h)}else{this.gridview.tableBody.append(h)}o++}this.gridview._updateScrollState();this.gridview.refreshRowNumber(o-1);this._fixParentIndexes(i,r,a);this._fixTreeIndexes(r+1+a,this.gridview.dataTable.length,this.gridview.dataTable,a)},_fixParentIndexes:function(i,r,s){var n=i[t];if(!n)return;var a=n[e],l=a.length,o=0;for(;o<l;o++){if(a[o]>r){a[o]=a[o]+s}}r=a[0]-1;if(r>=0){arguments.callee.call(this,n,r,s)}},_fixTreeIndexes:function(t,i,r,s){var n=t,a=i;var l,o,h;for(;n<a;n++){l=r[n];if(this.isTreeNode(l)){o=l[e];if(!o){continue}for(h=0;h<o.length;h++){o[h]=o[h]+s}}}},showChildren:function(t,i){if(!t[e]){if(this.lazy&&$.isFunction(this.loadChildrenHandler)){this.loadChildrenHandler(t,i)}}else{this.operateChildren(t[e],function(e,t){$(t).css("display","table-row");if(e._isFolded===true){return false}})}},hideChildren:function(t){if(t[e]){this.operateChildren(t[e],function(e,t){$(t).css("display","none")})}},operateChildren:function(t,i){if(!t){return}var r=0,s=t.length,n;var a=this.gridview.dataTable,l=this.gridview.tableBody[0].rows,o,h;for(;r<s;r++){n=t[r];o=a[n];h=i.call(this,o,l[n]);if(h===false){continue}if(o[e]){arguments.callee.call(this,o[e],i)}}},changeLevel:function(e,t,i,r){var s,n=this.gridview.dataTable,a,l;if(ui.core.type(e)!=="number"||e<0||e>=n.length){return}s=n[e];r=!!r;a=s._level;this._changeLevel(e,t,s,i);if(r){l=e+1;while(l<n.length){s=n[l];if(s._level<=a){return}this._changeLevel(l,t,s,i);l++}}},_changeLevel:function(e,t,i,r){var s=i._level+r;if(s<0)s=0;i._level=s;var n=this.gridview.option.columns[t],a=$(this.gridview.tableBody.get(0).rows[e].cells[t]);a.empty();a.append(n.handler.call(this.gridview,this.gridview.prepareValue(i,n),n,e,a))},isTreeNode:function(t){return!!t[e]},listTreeByLevel:function(t,i,s){var n=[];var a=r,l=r;if(!$.isArray(t)||t.length==0)return n;var o=[],h=[],d,u,c,f;for(d=0;d<t.length;d++){u=t[d];u[e]=[];u[i]=null;if(d>0){if(u._level-t[d-1]._level>1){u._level=t[d-1]._level+1}}else{u._level=0}f=u._level;o[f]=u;if(f==0){h.push(u);continue}c=o[f-1];c[e].push(u);u[i]=a.call(c,s)}this._sortListTree(h,n,null,0);return n},listTree:function(t,s,n){var a=[];var l=r,o=r;if(!$.isArray(t)||t.length==0)return a;if($.isFunction(s)){l=s}if($.isFunction(n)){o=n}var h={},d,u,c,f,p,g;for(f=0;f<t.length;f++){c=t[f];g=l.call(c,s)+""||"__";if(h.hasOwnProperty(g)){d=h[g];d[e].push(c)}else{d={};d[e]=[];d[e].push(c);h[g]=d}p=o.call(c,n)+"";if(h.hasOwnProperty(p)){d=h[p];c[e]=d[e];h[p]=c;c[i]=true}else{c[e]=[];c[i]=true;h[p]=c}}for(var v in h){d=h[v];if(!d.hasOwnProperty(i)){u=d;break}}this._sortListTree(u[e],a,null,0);return a},_sortListTree:function(r,s,n,a){var l=0,o=r.length,h;for(;l<o;l++){h=r[l];delete h[i];h._level=a;h[t]=n;s.push(h);r[l]=s.length-1;if(h[e].length>0){arguments.callee.call(this,h[e],s,h,a+1)}else{delete h[e]}}},setGridView:function(e){if(e instanceof ui.ctrls.GridView){this.gridview=e;this.gridview.treeGrid=this}}};ui.ctrls.TreeGrid=s})();(function(){function e(e){return{groupText:e}}function t(){return ui.core.type(this.itemIndexes)==="array"}function i(){if(this instanceof i){this.initial()}else{return new i}}function r(e,t,i,r){r.isFinal=true;r.attr("colspan",this.option.columns.length);r.click(this.groupGrid.onGroupRowClickHandler);this.groupGrid["_last_group_index_"]=e.groupIndex;return this.groupGrid.formatGroupItem.apply(this,arguments)}i.prototype={constructor:i,initial:function(){this.gridview=null;var e=this;this.onGroupRowClickHandler=function(t){t.stopPropagation();e.onGroupRowClick(t)}},listGroup:function(t,i,r){var s=[];var n={};if(!$.isArray(t)||t.length==0){return s}r=$.isFunction(r)?r:e;var a=0,l=t.length;var o,h,d;for(;a<l;a++){o=t[a];h=o[i];if(!n.hasOwnProperty(h)){d=r.call(o,h);d.itemIndexes=[a];n[h]=d}else{n[h].itemIndexes.push(a)}}for(h in n){d=n[h];s.push(d);d.groupIndex=s.length-1;for(a=0,l=d.itemIndexes.length;a<l;a++){s.push(t[d.itemIndexes[a]]);d.itemIndexes[a]=s.length-1}}return s},onGroupRowClick:function(e){var t=$(e.target);while(!t.isNodeName("td")){if(t.isNodeName("tr")){return}t=t.parent()}var i=this.gridview.dataTable[t.parent().get(0).rowIndex];if(t.hasClass("group-fold")){t.removeClass("group-fold");this.operateChildren(i.itemIndexes,function(e,t){$(t).css("display","table-row")})}else{t.addClass("group-fold");this.operateChildren(i.itemIndexes,function(e,t){$(t).css("display","none")})}},operateChildren:function(e,t){var i=0,r=e.length,s;var n=this.gridview.dataTable,a=this.gridview.tableBody[0].rows,l,o;for(;i<r;i++){s=e[i];l=n[s];t.call(this,l,a[s])}},formatRowNumber:function(e,i,s,n){var a=this.dataTable[s];if(t.call(a)){return r.call(this,a,i,s,n)}else{return"<span>"+(s-this.groupGrid["_last_group_index_"])+"</span>"}},formatText:function(e,i,s,n){var a=this.dataTable[s];if(t.call(a)){return r.call(this,a,i,s,n)}else{return ui.ColumnStyle.cfn.defaultText.apply(this,arguments)}},formatGroupItem:ui.core.noop,setGridView:function(e){if(e instanceof ui.ctrls.GridView){this.gridview=e;this.gridview.groupGrid=this}}};ui.ctrls.GroupGrid=i})();