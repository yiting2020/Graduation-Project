(function(){var e={};e["zh-CN"]={dateFormat:"yyyy-mm-dd",year:"年份",month:"月份",weeks:["日","一","二","三","四","五","六"],months:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],seasons:["一季","二季","三季","四季"]};e["en-US"]={dateFormat:"yyyy-mm-dd",year:"Year",month:"Month",weeks:["S","M","T","W","T","F","S"],months:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],seasons:["S I","S II","S III","S IV"]};var t=ui.theme.highlight.font;var a=/y+/i,n=/M+/,i=/d+/i,s=/h+/i,r=/m+/,l=/s+/i;ui.define("ctrls.DateChooser",ui.ctrls.DropDownPanel,{_getOption:function(){return{dateFormat:"yyyy-MM-dd",language:"zh-CN",calendarPanel:null,isDateTime:false}},_getEvents:function(){return["selecting","selected","canceled"]},_create:function(){this._super();var t="yyyy-MM-dd";this.isDateTime=!!this.option.isDateTime;if(this.isDateTime){t="yyyy-MM-dd hh:mm:ss"}this.option.dateFormat=this.dateFormat=this.option.dateFormat||t;this._now=new Date;this._year=this._now.getFullYear();this._month=this._now.getMonth();this._selDay=this._now.getDate();this._language=e[this.option.language];if(!this._language){this._language=e["zh-CN"]}this._calendarPanel=ui.getJQueryElement(this.option.calendarPanel);this._daysTable=null;this._linkBtn=null;this._setDatePanel=null;this._monthsTable=null;this._yearsTable=null;this._currentlyObj=null},_init:function(){if(!this._calendarPanel){this._calendarPanel=$("<div />");this._calendarPanel.click(function(e){e.stopPropagation()})}this._calendarPanel.addHighlight("calendar-panel","border");this._showClass="dateChooser-show";this._panel=this._calendarPanel;this._selectTextClass="date-text";this._clearClass="dateChooser-clear";this._clear=$.proxy(function(){this.cancelSelection()},this);this._calendarPanel.append(this._createDateSetPanel());this._calendarPanel.append(this._createTitlePanel());this._calendarPanel.append(this._createDatePanel());this._calendarPanel.append(this._createCtrlPanel())},_createDateSetPanel:function(){this._setDatePanel=$("<div class='set-date-panel' />");var e=$("<div class='set-title font-highlight' style='height:24px;line-height:24px;' />");this._setDatePanel.append(e);var t=$("<div class='prev'/>");t.click({calendar:this,value:-10},this.events.onYearChanged);e.append(t);e.append("<div class='date-title'><span id='yearTitle'>"+this._language.year+"</span></div>");var a=$("<div class='next'/>");a.click({calendar:this,value:10},this.events.onYearChanged);e.append(a);e.append($("<br clear='left' />"));this._setDatePanel.append(this._createSetYearPanel());var n=$("<div class='set-title font-highlight' style='text-align:center;height:27px;line-height:27px;' />");var i=[];i.push("<fieldset class='title-fieldset border-highlight'>");i.push("<legend class='title-legend font-highlight'>",this._language.month,"</legend>");i.push("</fieldset>");n.html(i.join(""));this._setDatePanel.append(n);this._setDatePanel.append(this._createSetMonthPanel());this._setDatePanel.append(this._createOkCancel());return this._setDatePanel},_createSetYearPanel:function(){var e=$("<div class='set-year-panel' />");this._yearsTable=$("<table cellpadding='0' cellspacing='0'/>");var t=$("<tbody />");t.click({calendar:this},this.events.onYearSelected);var a=null;var n=null;for(var i=0;i<3;i++){a=$("<tr />");for(var s=0;s<5;s++){n=$("<td />");a.append(n)}t.append(a)}this._yearsTable.append(t);e.append(this._yearsTable);return e},_createSetMonthPanel:function(){var e=$("<div class='set-month-panel' />");this._monthsTable=$("<table cellpadding='0' cellspacing='0'/>");var t=$("<tbody />");t.click({calendar:this},this.events.onMonthSelected);var a=null;var n=0;for(var i=0;i<3;i++){a=$("<tr />");var s=null;for(var r=0;r<4;r++){s=$("<td />");s.html(this._language.months[n]);s.data("month",n++);a.append(s)}t.append(a)}this._monthsTable.append(t);e.append(this._monthsTable);return e},_createOkCancel:function(){var e=$("<div class='ctrl-panel' />");e.append(this._createButton(this.events.onSetYearMonthChanged,"ok-button",{"margin-right":"10px"}));e.append(this._createButton(this.events.onYearMonthCancel,"cancel-button"));return e},_createTitlePanel:function(){var e=$("<div class='cal-title-panel' />");e.append(this._createPrevButton());e.append(this._createOptionButton());e.append(this._createNextButton());e.append($("<br clear='left' />"));return e},_createPrevButton:function(){var e=$("<div class='prev' />");var t=this;e.bind("click",function(e){e.stopPropagation();var a=new Date(t._year,t._month-1,1);t._year=a.getFullYear();t._month=a.getMonth();t._fillDays()});return e},_createOptionButton:function(){var e=$("<div class='date-title' />");this._linkBtn=$("<a href='javascript:void(0)' />");this._linkBtn.addHighlight("option","font");this._linkBtn.html(this.formatter.formatDateTitle(this._year,this._month));var t=this;this._linkBtn.click(function(e){e.stopPropagation();t._fillYearAndMonth(t._year,true);t._setDatePanel.css({top:"-199px",display:"block"}).stop().animate({top:"0px"},300)});e.append(this._linkBtn);return e},_createNextButton:function(){var e=$("<div class='next' />");var t=this;e.bind("click",function(e){var a=new Date(t._year,t._month+1,1);t._year=a.getFullYear();t._month=a.getMonth();t._fillDays();e.stopPropagation()});return e},_createDatePanel:function(){var e=$("<div class='date-panel' />");e.append(this._createWeekPanel());e.append(this._createDaysPanel());return e},_createWeekPanel:function(){var e=$("<div class='week-panel'/>");var t=$("<table cellpadding='0' cellspacing='0' />");var a=$("<tbody />");var n=$("<tr />");var i=null;for(var s=0;s<7;s++){i=$("<th />");i.text(this._language.weeks[s]);if(s==0||s==6){i.addClass("weekend")}n.append(i)}a.append(n);t.append(a);e.append(t);return e},_createDaysPanel:function(){var e=$("<div class='days-panel' />");e.addClass("days-panel");this._daysTable=$("<table cellpadding='0' cellspacing='0' />");var t=$("<tbody />");var a,n;for(n=0;n<6;n++){a=$("<tr />");for(var i=0;i<7;i++){a.append($("<td />"))}t.append(a)}this._daysTable.append(t);e.append(this._daysTable);e.click($.proxy(this.events.onDaySelected,this));return e},_createCtrlPanel:function(){var e=$("<div />"),t,a=this;e.addClass("ctrl-panel");if(!this.isDateTime){e.append(this._createButton(this.events.onTodaySelected,"today-button"))}else{t=this._now.getHours();t=t<10?"0"+t:t;this.hourText=$("<input type='text' class='hour time-input font-highlight-hover' />");this.hourText.val(t);e.append(this.hourText);e.append("<span style='margin-left:2px;margin-right:2px;'>:</span>");t=this._now.getMinutes();t=t<10?"0"+t:t;this.minuteText=$("<input type='text' class='minute time-input font-highlight-hover' />");this.minuteText.val(t);e.append(this.minuteText);e.append("<span style='margin-left:2px;margin-right:2px;'>:</span>");t=this._now.getDate();t=t<10?"0"+t:t;this.secondText=$("<input type='text' class='second time-input font-highlight-hover' />");this.secondText.val(t);e.append(this.secondText);e.mousewheel(function(e){var t=$(e.target),n=60,i,s,r,l;if(t.nodeName()!=="INPUT"){return}if(t.hasClass("hour")){n=24}i=t.val();i=parseFloat(i);i+=-e.delta;if(i<0)i=n-1;else if(i>=n)i=0;i=i<10?"0"+i:i;t.val(i);s=parseInt(a.hourText.val(),10);r=parseInt(a.minuteText.val(),10);l=parseInt(a.secondText.val(),10);a.selectedDate(new Date(a._year,a._month,a._selDay,s,r,l))});t=function(e){var t=$(e.target),n,i,s;if(t.val().length==0){return}n=parseInt(a.hourText.val(),10);if(isNaN(n)||n<0||n>=24){n=a._now.getHours();a.hourText.val(n<10?"0"+n:n);return}i=parseInt(a.minuteText.val(),10);if(isNaN(i)||i<0||i>=60){i=a._now.getMinutes();a.minuteText.val(i<10?"0"+i:i);return}s=parseInt(a.secondText.val(),10);if(isNaN(s)||s<0||s>=60){s=a._now.getSeconds();a.secondText.val(s<10?"0"+s:s);return}a.selectedDate(new Date(a._year,a._month,a._selDay,n,i,s))};this.hourText.textinput(t);this.minuteText.textinput(t);this.secondText.textinput(t)}return e},_createButton:function(e,t,a){var n=$("<a class='calendar-button' />");if(t)n.addClass(t);if(typeof a==="object")n.css(a);n.click({calendar:this},e);return n},_initYearAndMonth:function(e){this._year=this.formatter.findItem(a,e,this.dateFormat);this._month=this.formatter.findItem(n,e,this.dateFormat);this._selDay=this.formatter.findItem(i,e,this.dateFormat);if(isNaN(this._year)||this._year<=1970||this._year>9999){this._year=this._now.getFullYear()}this._month--;if(isNaN(this._month)||this._month<0||this._month>11){this._month=this._now.getMonth()}if(isNaN(this._selDay)||this._selDay<=0||this._selDay>31){this._selDay=this._now.getDate()}},_initTime:function(e){if(!this.isDateTime){return}var t,a,n;t=this.formatter.findItem(s,e,this.dateFormat);a=this.formatter.findItem(r,e,this.dateFormat);n=this.formatter.findItem(l,e,this.dateFormat);if(isNaN(t)||t<0||t>=24){t=this._now.getHours()}if(isNaN(a)||a<0||a>=60){a=this._now.getMinutes()}if(isNaN(n)||n<0||n>=60){n=this._now.getSeconds()}t=t<10?"0"+t:t;a=a<10?"0"+a:a;n=n<10?"0"+n:n;this.hourText.val(t);this.minuteText.val(a);this.secondText.val(n)},_lTrimZero:function(e){return e.replace(/(^0*)/g,"")},_fillDays:function(){var e=[];var a=new Date(this._year,this._month,0);var n=new Date(this._year,this._month,1);var i=new Date(this._year,this._month+1,1);var s=n.getDay();var r=a.getFullYear(),l=a.getMonth(),h=a.getDate();if(s>0){for(var o=h-(s-1);o<=h;o++){e.push(this.formatter.createDay(r,l,o,true))}}var d=new Date(this._year,this._month+1,0).getDate();for(o=1;o<=d;o++){e.push(this.formatter.createDay(this._year,this._month,o,false))}r=i.getFullYear();l=i.getMonth();var c=42-e.length;for(o=1;o<=c;o++){e.push(this.formatter.createDay(r,l,o,true))}$(this._linkBtn).html(this.formatter.formatDateTitle(this._year,this._month));var u=this._daysTable.find("td");var f=this._now.getFullYear(),n=this._now.getMonth(),p=this._now.getDate();var m;for(o=0;o<u.length;o++){m=$(u[o]);m.removeAttr("class");h=e.shift();m.html("<span>"+h.date+"</span>").data("date",h);if(this._month===h.month&&h.date===this._selDay){this.selectedDay=m;this.selectedDay.addHighlight("selected","background")}if(h.year===f&&h.month===n&&h.date===p){m.addClass(t)}if(h.isOtherMonth){m.addClass("other-month")}}},_fillYearAndMonth:function(e,t){var a=Math.floor(e/15)*15,n="selected";this._yearsTable.data("year",e);var i=this._yearsTable.find("td"),s=null;$("#yearTitle").text(a+"年 ~ "+(a+i.length-1)+"年");for(var r=0;r<i.length;r++){var l=a++;s=$(i[r]);s.removeHighlight(n,"background");s.html(l);if(l==e){s.addHighlight(n,"background");this.currentYear=s}}var h,o,d;if(t){h=this._monthsTable.find("tr");this._monthsTable.data("month",this._month);for(r=0;r<h.length;r++){o=$(h[r]);d=o.find("td");for(var c=0;c<d.length;c++){s=$(d[c]);s.removeHighlight(n,"background");s.removeAttr("style");if(s.data("month")==this._month){s.addHighlight(n,"background");this.currentMonth=s}}}}},_formatDateValue:function(e){var t=this.dateFormat;t=t.replace(a,e.getFullYear());t=this.formatter.formatItem(n,e.getMonth()+1,t);t=this.formatter.formatItem(i,e.getDate(),t);if(this.isDateTime){t=this.formatter.formatItem(s,e.getHours(),t);t=this.formatter.formatItem(r,e.getMinutes(),t);t=this.formatter.formatItem(l,e.getSeconds(),t)}return t},events:{onDaySelected:function(e){var t=$(e.target),a=t.nodeName();if(a==="SPAN"){t=t.parent()}if(t.nodeName()!=="TD"){return}var n=t.data("date"),i=0,s=0,r=0;if(this.isDateTime){i=parseInt(this.hourText.val(),10);s=parseInt(this.minuteText.val(),10);r=parseInt(this.secondText.val(),10)}var l=new Date(n.year,n.month,n.date,i,s,r);if(this.selectedDay){this.selectedDay.removeHighlight("selected","background");this.selectedDay=null}this.selectedDay=t;this.selectedDay.addHighlight("selected","background");this.selectedDate(l)},onTodaySelected:function(e){var t=new Date,a=e.data.calendar;a.selectedDate(t);a._fillDays()},onYearChanged:function(e){e.data.calendar._fillYearAndMonth(e.data.calendar._yearsTable.data("year")+e.data.value)},onYearSelected:function(e){var t=$(e.target),a="selected";if(t.nodeName()!=="TD"){return}if(e.data.calendar.currentYear){e.data.calendar.currentYear.removeHighlight(a,"background")}t.addHighlight(a,"background");e.data.calendar.currentYear=t;e.data.calendar._yearsTable.data("year",parseInt(t.text(),10));e.stopPropagation()},onMonthSelected:function(e){e.stopPropagation();var t=$(e.target),a=e.data.calendar,n="selected";if(t.nodeName()!=="TD"||t.hasClass("season-cell")){return}if(a.currentMonth){a.currentMonth.removeHighlight(n,"background")}t.addHighlight(n,"background");a.currentMonth=t;a._monthsTable.data("month",t.data("month"))},onSetYearMonthChanged:function(e){e.stopPropagation();var t=e.data.calendar,a,n,i;t._year=parseInt(t._yearsTable.data("year"));t._month=parseInt(t._monthsTable.data("month"));t._fillDays();a=n=i=0;if(t.hourText&&t.minuteText&&t.secondText){a=parseInt(t.hourText.val(),10)||0;n=parseInt(t.minuteText.val(),10)||0;i=parseInt(t.secondText.val(),10)||0}t.selectedDate(new Date(t._year,t._month,t._selDay,a,n,i));t._setDatePanel.stop().animate({top:"-199px"},300,function(){t._setDatePanel.css("display","none")})},onYearMonthCancel:function(e){e.stopPropagation();var t=e.data.calendar;t._setDatePanel.stop().animate({top:"-199px"},300,function(){t._setDatePanel.css("display","none")})}},formatter:{formatDateTitle:function(e,t){var a=t+1;if(a<10){a="0"+a}return e+"-"+a+"&nbsp;▼"},createDay:function(e,t,a,n){return{year:e,month:t,date:a,isOtherMonth:n}},formatItem:function(e,t,a){var n=e.exec(a);if(n!=null){t=n[0].length>1&&t<10?"0"+t:t}return a.replace(e,t)},findItem:function(e,t,a){var n=e.exec(a);if(n!=null){return parseInt(t.substring(n.index,n.index+n[0].length),10)}else{return NaN}}},selectedDate:function(e){this._year=e.getFullYear();this._month=e.getMonth();this._selDay=e.getDate();var t=this._formatDateValue(e);var a=this.fire("selecting",this.element,t,e);if(a===false){return}this.fire("selected",this.element,t,e)},cancelSelection:function(){if(this.selectedDay){this.selectedDay.removeHighlight("selected","background")}this.fire("canceled")},show:function(){var e=this,t=this._super;if(!this.isShow()){this.moveToElement(this.element,true);t.call(this)}else{this.hide(function(){e.moveToElement(e.element,true);t.call(e)})}}});var h=null,o=null;var d=function(e){return e.text()};var c=function(e){return e.val()};var u=function(e,t){var a=ui.ctrls.DateChooser(e,t);a.selecting(function(e,t,n,i){if($.isFunction(a.selectingHandler)){return a.selectingHandler(t,n,i)}});a.selected(function(e,t,n,i){if($.isFunction(a.selectedHandler)){a.selectedHandler(t,n,i)}else{if(this.element.nodeName()==="INPUT"){this.element.val(n)}else{this.element.html(n)}}});a.canceled(function(e){if($.isFunction(a.clearHandler)){a.clearHandler()}else{if(this.element.nodeName()==="INPUT"){this.element.val("")}else{this.element.html("")}}});return a};var f=function(e){if(!this.isShow()){this.element.css("cursor","auto");this._clearable=false;return}var t=this.element.width(),a=e.offsetX;if(!a){a=e.clientX-this.element.offset().left}if(t-a<0){this.element.css("cursor","pointer");this._clearable=true}else{this.element.css("cursor","auto");this._clearable=false}};var p=function(e){if(!this._clearable){return}var t=this.element.width(),a=e.offsetX;if(!a){a=e.clientX-this.element.offset().left}if(t-a<0){if($.isFunction(this._clear)){this._clear()}}};$.fn.dateChooser=function(e){if(!this||this.length==0){return null}if(this.hasClass("date-text")){this.css("width",parseFloat(this.css("width"),10)-23+"px")}var t=this.nodeName();if(t!=="INPUT"&&t!=="A"&&t!=="SELECT"){this.attr("tabindex",0)}var a,n;if(this.nodeName()==="INPUT"){a=c}else{a=d}if(e&&e.isDateTime){if(!o){o=u({isDateTime:true},this)}n=o}else{if(!h){h=u(null,this)}n=h}e=$.extend({},n.option,e);this.focus(function(t){var i=$(t.target);if(n.isShow()&&n.element&&n.element[0]===i[0]){return}if(n.element){n.element.removeClass(n._clearClass)}n._now=new Date;n.option=e;n.setLayoutPanel(e.layoutPanel);n.dateFormat=e.dateFormat;n.selectingHandler=e.selectingHandler;n.selectedHandler=e.selectedHandler;n.clearHandler=e.clearHandler;ui.hideAll(n);n.element=i;if(n.element.nodeName()==="INPUT"){n.onMousemoveHandler=$.proxy(f,n);n.onMouseupHandler=$.proxy(p,n)}else{n.onMousemoveHandler=ui.core.noop;n.onMouseupHandler=ui.core.noop}var s=a(n.element);if(!s){s=ui.str.empty}n._initYearAndMonth(s);if(n.isDateTime){n._initTime(s)}n._fillDays();n.show()}).click(function(e){e.stopPropagation()});return n};$.fn.putDateChooser=function(e){if(!this||this.length==0){return null}var t=this.nodeName();if(t==="INPUT"||t==="SPAN"){return null}if(!e){e={}}e.calendarPanel=this;var a=ui.ctrls.DateChooser(e,null);a._calendarPanel.css("display","block");a._fillDays();return a}})();