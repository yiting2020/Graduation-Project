(function(){var t="sl-ul",i="list-panel",e="selection-item";var s="selecting",l="selected",n="canceled";var a=function(t){return this[t]};var r=function(t){var i=[],e=0;for(;e<t.length;e++){i.push(this[t[e]])}return i.join("_")};var h=ui.define("ctrls.SelectionList",ui.ctrls.DropDownPanel,{_getOption:function(){return{multiple:false,valueField:null,textField:null,data:null,fillItemHandler:null}},_getEvents:function(){return[s,l,n]},_create:function(){this._super();this.target=this.element;this.current=null;this.selectList=[];if($.isArray(this.option.valueField)){this._getValue=r}else if($.isFunction(this.option.valueField)){this._getValue=this.option.valueField}else{this._getValue=a}if($.isArray(this.option.textField)){this._getText=r}else if($.isFunction(this.option.textField)){this._getText=this.option.textField}else{this._getText=a}},_init:function(){this.listPanel=$("<div class='list-panel border-highlight' />");this.listPanel.click($.proxy(this.onListSelection,this));this.wrapElement(this.element,this.listPanel);this._showClass="sl-show";this._clearClass="sl-clear";this._clear=function(){this.cancelSelection()};this._selectTextClass="select-text";this.initPanelWidth(this.option.width);if($.isFunction(this.option.fillItemHandler)){this.getText=this.option.fillItemHandler}if($.isArray(this.option.data)){this._fill(this.option.data)}this._super()},_fill:function(i){this.empty();var e=$("<ul />").addClass(t);var s,l;if(i&&i.length){for(l=0;l<i.length;l++){s=$("<li />");if(this.option.multiple){s.append($("<input type='checkbox' />"))}s.append(this.getText(i[l],l));s.data("index",l);e.append(s)}}this.listPanel.append(e)},getText:function(t,i){var e="";if(typeof t==="string"){e=t}else if(t){e=this._getText.call(t,this.option.textField)}var s=$("<span />").text(e);return s},setData:function(t){if($.isArray(t)){this.option.data=t}else if(typeof t==="string"){this.option.data=[t]}else{return}this._fill(this.option.data)},getCurrentSelection:function(){var t=null;if(this.current){t=this.option.data[this.current.data("index")]}return t},setCurrentSelection:function(t){this.cancelSelection();if(!t)return;var i=[t],e={li:null};this._setListValues(i,e);if(e.li){this.fire(l,e.li,this._wrapListData(this.option.data[e.li.data("index")]))}},getMultipleSelection:function(){var t=[];for(var i=0;i<this.selectList.length;i++){t[i]=this.selectList[i].data}return t},setMultipleSelection:function(t){this.cancelSelection();if(!$.isArray(t))return;var i={li:null};this._setListValues(t,i);if(i.li){this.fire(l,i.li,this._wrapListData(this.option.data[i.li.data("index")]))}},cancelSelection:function(){var t=null;if(this.option.multiple===true){for(var i=0;i<this.selectList.length;i++){t=this.selectList[i].elem;t.find("input[type='checkbox']").prop("checked",false)}this.selectList=[]}else{if(this.current){this.current.removeHighlight(e,"background");this.current=null}}this.fire(n)},empty:function(){this.listPanel.html("");this.selectList=[];this.current=null;this.fire(n)},_setListValues:function(t,i){var e=t.length;var s=null;var l,n,a;t=t.slice(0);for(l=0,a=this.option.data.length;l<a;l++){s=this.option.data[l];for(n=0;n<e;n++){if(this._equalValue(s,t[n])){i.li=this._setListValue(s,l);e--;t.splice(n,1);break}}if(e==0)break}},_equalValue:function(t,i){if(typeof t==="string"){return t===i+""}else if(ui.core.type(t)==="object"&&ui.core.type(i)!=="object"){return this._getValue.call(t,this.option.valueField)===i}else{return this._getValue.call(t,this.option.valueField)===this._getValue.call(i,this.option.valueField)}},_setListValue:function(t,i){var e=this.listPanel.find("ul").children();var s=$(e[i]);this._selectItem(s,t,false,true,false);return s},onListSelection:function(t){if(this.option.multiple){t.stopPropagation()}var e=$(t.target);var s=e.nodeName();var l=s==="INPUT";while(s!=="LI"){if(e.hasClass(i))return;e=e.parent();s=e.nodeName()}var n=this.option.data[e.data("index")];this._selectItem(e,n,l)},_wrapListData:function(t){return{data:t}},_selectItem:function(t,i,n,a,r){var h=this._wrapListData(i);var o=this.fire(s,t,h);if(o===false)return;var u=null;var c=null;if(this.option.multiple===true){u=t.find("input[type='checkbox']");if(!a){if(n){c=u.prop("checked")}else{c=!u.prop("checked")}}else{c=a}u.prop("checked",c);h.isSelected=c;if(!c){for(var f=0;f<this.selectList.length;f++){if(this.selectList[f].elem[0]==t[0]){this.selectList.splice(f,1);break}}}else{this.selectList.push({elem:t,data:i})}}else{if(this.current){if(this.current[0]==t[0]){return}this.current.removeHighlight(e,"background")}this.current=t;h.isSelected=true;t.addHighlight(e,"background")}if(r===false){return}this.fire(l,t,h)}});$.fn.setSelectList=function(t){if(!this||this.length==0){return null}return h(t,this)}})();(function(){var t=ui.define("ctrls.ListView",ui.ctrls.SelectionList,{_init:function(){this.listPanel=this.element;var t=this.listPanel.css("position");this.listPanel.addClass("list-panel").addClass("list-view-panel").css({position:t});this.listPanel.click($.proxy(this.onListSelection,this));if($.isFunction(this.option.fillItemHandler)){this.getText=this.option.fillItemHandler}if($.isArray(this.option.data)){this._fill(this.option.data)}}});$.fn.setListView=function(i){if(!this||this.length==0){return null}return t(i,this)}})();